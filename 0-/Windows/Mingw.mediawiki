__TOC__
Tested with [http://exodus.xmms.se/~nano/win32/xmms2-win32_older_snapshot_ion_bidon.tar.gz this modified snapshot]
==Prepare the environment==
*Download [http://www.python.org/ftp/python/2.4.2/python-2.4.2.msi Python 2.4.2] and install it in '''C:\Python24'''
*Download [http://prdownloads.sourceforge.net/scons/scons-0.96.1.win32.exe Scons 0.96.1] and install it in '''C:\Python24'''
*Download [http://prdownloads.sourceforge.net/mingw/MinGW-3.2.0-rc-3.exe MinGW-3.2.0-rc-3] and install it in '''C:\xmms2_mingw'''
:'''Warning''' : other mingw installers or other gcc versions might not work.
*Download [http://prdownloads.sourceforge.net/mingw/MSYS-1.0.10.exe Msys 1.0.10] and install it in '''C:\xmms2_mingw'''. When asked for the post install, answer '''y'''. After that, when asked if you have mingw installed, answer '''y''' and then put the directory '''c:/xmms2_mingw''' (yes, with unix-like slashes).

==Setting up the required libraries and the git snapshot==
*Download [http://exodus.xmms.se/~nano/win32/xmms2_required_libraries.tar.gz xmms2_required_libraries.tar.gz] and put it in '''C:\xmms2_mingw\home\<user>''' 
:Package contents : ''glib 2.8.6'' (include some dependencies) , ''sqlite 3.3.4'' and the ''scons.sh'' script (found in /bin)
*Download the [http://git.xmms.se/snapshot.cgi/xmms2-stable.git-snapshot-HEAD.tar.bz2 git xmms2-stable snapshot], extract it on a unix-like system (I couldn't extract it correctly with any windows extractor) and put the resulted directory in '''C:\xmms2_mingw\home\<user>'''

==Changes in the source code (long)==
'''SConstruct line 29''' :
*replace
<pre>
if sys.platform == 'win32':
	default_pyrex = 'pyrexc.py'
	default_prefix = 'c:\\xmms2'
	default_cxxflags = ['/Zi', '/TC']
	default_cflags = ['/Zi', '/TC']
	default_cpppath = ['z:\\xmms2\\winlibs\\include']
else:
	default_pyrex = 'pyrexc'
	default_prefix = '/usr/local/'
	default_cxxflags = ['-g', '-Wall', '-O0']
	default_cflags = ['-g', '-Wall', '-O0']
	if sys.platform == 'darwin':
		default_cpppath = ['/sw/lib']
	else:
		default_cpppath = []
</pre>
:with :
<pre>
#if sys.platform == 'win32':
#	default_pyrex = 'pyrexc.py'
#	default_prefix = 'c:\\xmms2'
#	default_cxxflags = ['/Zi', '/TC']
#	default_cflags = ['/Zi', '/TC']
#	default_cpppath = ['z:\\xmms2\\winlibs\\include']
#else:
default_pyrex = 'pyrexc'
default_prefix = '/usr/local/'
default_cxxflags = ['-g', '-Wall', '-O0']
default_cflags = ['-g', '-Wall', '-O0']
if sys.platform == 'darwin':
	default_cpppath = ['/sw/lib']
else:
	default_cpppath = []
</pre>

'''src/include/xmmsc/xmmsc_sockets.h line 8''' :
*replace
<pre>
#ifdef _MSC_VER
</pre>
:with :
<pre>
#ifdef __WIN32__
</pre>

'''src/clients/cli/common.h line 24''' :
*replace
<pre>
#include <sys/ioctl.h>
</pre>
:with :
<pre>

#ifndef __WIN32__
#include <sys/ioctl.h>
#endif
</pre>

'''src/clients/cli/cmd_mlib.c''' line 627 or at the top:
*add
<pre>
#ifdef __WIN32__
#include <windows.h>
char *realpath(const char *pathname, char resolved_path[PATH_MAX])
{
  gint size = 0;
  size = GetFullPathNameA(pathname, PATH_MAX, resolved_path, 0);
  if (size > PATH_MAX)
    {
      return NULL;
    }
  else
    {
      return resolved_path;
    }
}
#endif
</pre>

'''src/clients/cli/common.c line 18''' :
*add
<pre>
#ifdef __WIN32__
#include <windows.h>
extern char *realpath(const char *pathname, char resolved_path[PATH_MAX]);
#endif
</pre>

'''src/clients/cli/common.c line 116''' :
*replace
<pre>
gint
find_terminal_width() {
	gint columns = 0;
	struct winsize ws;
	char *colstr, *endptr;

	if (!ioctl(STDIN_FILENO, TIOCGWINSZ, &ws)) {
		columns = ws.ws_col;
	} 
	else {
		colstr = getenv("COLUMNS");
		if(colstr != NULL) {
			columns = strtol(colstr, &endptr, 10);
		}
	}

	/* Default to 80 columns */
	if(columns <= 0) {
		columns = 80;
	}

	return columns;
}
</pre>
:with :
<pre>
gint
find_terminal_width() {
#ifdef __WIN32__
  return 80;
#else
	gint columns = 0;
	struct winsize ws;
	char *colstr, *endptr;

	if (!ioctl(STDIN_FILENO, TIOCGWINSZ, &ws)) {
		columns = ws.ws_col;
	} 
	else {
		colstr = getenv("COLUMNS");
		if(colstr != NULL) {
			columns = strtol(colstr, &endptr, 10);
		}
	}

	/* Default to 80 columns */
	if(columns <= 0) {
		columns = 80;
	}

	return columns;
#endif
}
</pre>

'''src/clients/cli/main.c line 106''' :
*replace
<pre>
		mkdir (dir, 0755);
</pre>
:with :
<pre>
#ifdef __WIN32__
		mkdir (dir);
#else
		mkdir (dir, 0755);
#endif
</pre>

'''src/clients/cli/main.c line 21''' :
*add
<pre>
#ifdef __WIN32__
#include <io.h>
#endif
</pre>

'''src/clients/lib/xmmsclient/xmmsclient.c line 21''' :
*replace
<pre>
#include <pwd.h>
</pre>
:with :
<pre>
#ifndef __WIN32__
#include <pwd.h>
#endif
</pre>

'''src/clients/lib/xmmsclient/xmmsclient.c line 168''' :
*replace
<pre>
	if (!ipcpath) {
		struct passwd *pwd;

		pwd = getpwuid (getuid ());
		if (!pwd || !pwd->pw_name)
			return false;

		snprintf (path, sizeof(path), "unix:///tmp/xmms-ipc-%s", pwd->pw_name);
	} else {
</pre>
:with :
<pre>
#ifndef __WIN32__
	if (!ipcpath) {
		struct passwd *pwd;

		pwd = getpwuid (getuid ());
		if (!pwd || !pwd->pw_name)
			return false;

		snprintf (path, sizeof(path), "unix:///tmp/xmms-ipc-%s", pwd->pw_name);
	} else
#endif
	{
</pre>

'''src/clients/lib/xmmsclient-glib/Library line 8''' :
*add
<pre>
	if env.platform == 'win32':
		env.Prepend(LIBPATH=["src/clients/lib/xmmsclient"])
		env.Append(LIBS=["xmmsclient"])
		env.Prepend(LIBPATH=["src/lib/xmmsipc"])
		env.Append(LIBS=["xmmsipc"])
		env.Prepend(LIBPATH=["src/lib/xmmssocket"])
		env.Append(LIBS=["xmmssocket"])
		env.Append(LIBS=["wsock32"])
		env.Append(LIBS=["ws2_32"])
</pre>

'''src/include/xmmsc/xmmsc_ipc_transport.h line 34''' :
*replace
<pre>
int xmms_ipc_transport_fd_get (xmms_ipc_transport_t *ipct);
</pre>
:with :
<pre>
xmms_socket_t xmms_ipc_transport_fd_get (xmms_ipc_transport_t *ipct);
</pre>

'''src/clients/cli/Program line 18''' :
*add
<pre>
	if env.platform == 'win32':
		env.Append(LIBS=["wsock32"])
</pre>

'''src/clients/et/xmms2-et.c line 24''' :
*replace
<pre>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <time.h>
#include <sys/utsname.h>
</pre>
:with :
<pre>
#ifdef __WIN32__
#include <winsock2.h>
#else
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <sys/utsname.h>
#endif

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <time.h>
</pre>

'''src/clients/et/xmms2-et.c line 225''' :
*replace
<pre>
static void
get_systemname (void)
{
	struct utsname uts;

	if (uname (&uts) == 0) {
		system_name = g_strdup_printf ("%s %s %s",
		                               uts.sysname,
		                               uts.release,
		                               uts.machine);
	}
}
</pre>
:with :
<pre>
static void
get_systemname (void)
{
#ifdef __WIN32__
  system_name = g_strdup_printf ("%s", "win32");
#else
	struct utsname uts;

	if (uname (&uts) == 0) {
		system_name = g_strdup_printf ("%s %s %s",
		                               uts.sysname,
		                               uts.release,
		                               uts.machine);
	}
#endif
}
</pre>

'''src/clients/et/xmms2-et.c line 279''' :
*replace
<pre>
	inet_aton (DEST_IP, &dest_addr.sin_addr);
</pre>
:with :
<pre>
//this will make xmms2-et unfunctional on windows but it will compile
#ifndef __WIN32__
	inet_aton (DEST_IP, &dest_addr.sin_addr);
#endif
</pre>

'''src/clients/et/Library line 11''' :
*add
<pre>
	if env.platform == 'win32':
		env.Append(LIBS=["wsock32"])
</pre>

'''src/plugins/diskwrite/diskwrite.c line 194''' :
*replace
<pre>

</pre>
:with :
<pre>

</pre>

==Compilation==
*Double click on the MSYS icon that have been placed on the desktop, or launch msys.bat from the '''C:\xmms2_mingw''' directory
*Extract the needed libraries like this :
 tar zxf xmms2_required_libraries.tar.gz -C /
*Type :
 export PKG_CONFIG_PATH=/usr/lib/pkgconfig/
*Go in the directory '''/home/<user>/xmms2-stable.git...''' and type
 scons.sh
*To build the xmms2d dlls, type : 
 mv src/xmms/library src/xmms/Library && mv src/xmms/Program src/xmms/program && scons.sh

==Test xmms2==
*Download [http://exodus.xmms.se/~nano/win32/xmms-runtime.tar.gz xmms-runtime.tar.gz], extract it and copy the files from the '''xmms2_runtime''' directory to '''C:\xmms2'''
*Copy the following files to '''C:\xmms2''' :
 src/clients/lib/xmmsclient/libxmmsclient.dll
 src/clients/lib/xmmsclient-glib/libxmmsclient-glib.dll
 src/plugins/null/libxmms_null.dll
 src/xmms/libxmms2d.dll
 src/clients/cli/xmms2.exe
 src/xmms/xmms2d.exe
*Go in the '''C:\xmms2''' directory (from cmd.exe or msys) and start the daemon :
 ./xmms2d.exe -p . -i tcp://127.0.0.1:1234 -v
:You will see that the null output is used
*In another console, test with xmms2