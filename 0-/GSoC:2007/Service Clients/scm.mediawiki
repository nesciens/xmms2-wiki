= What It Does =

Service Client Manager (scm in short) is a meta service client that manages all other local service clients.  It will be started automatically when the server starts.  And it scans service_clients sub-directory in XMMS2 config dir for service client description files.  Each file inside that directory is considered a description file for a single service client, with the name of the file as the name of the service client.  This file describes the path of the executable file, arguments passing to that file, if it needs to be launched automatically, service descriptions, versions and method descriptions of a service client.  So that clients can query for installed service clients' information even if they are not registered to the server at the moment.  Furthermore, clients can control a service client by issuing launch and shutdown requests to scm, or toggle the auto option of the service client.  When the server shuts down, scm checks if all local service clients have shut down.  If not, it will wait until time out and then kill those which are still running.  Otherwise, scm will terminate normally after several seconds.

Remote service clients are not managed by scm.  Since they cannot be shut down or launched remotely, and it is impossible to check for the presence of the executable files, it is unnecessary for scm to manage them.

= Config File Structure =

Config file should be placed under service_clients sub-directory in XMMS2 config dir on installation of the service client if it resides on the same machine as the server does.  And the name of the config file should be the same as that of the service client.  Config file must contain the following information.

* path to the executable file
* service name(s)
* method name(s) and description(s)

The following table shows the keywords and descriptions for each keyword supported by scm.

{| class="wikitable" style="text-align:center;margin: 1em auto 1em auto"
|+Keyword Descriptions
|-
! Keyword !! Description !! Type
|-
! path
| path to the executable file || string
|-
! argv
| command-line arguments to pass to the executable file || string
|-
! auto
| if the service client should be launched automatically || "yes" or "no"
|-
! [service name]
| service name should be surrounded by brackets || string
|-
! description
| service descriptions || string
|-
! major
| major version of service || unsigned integer
|-
! minor
| minor version of service || unsigned integer
|-
|}

Here is an example of what a config file should look like.  Note that "path", "argv" (if any) and "auto" should always come first.  Because after "[service name]", every line is considered to be service related information until the next "[service name]".

Contents of file "shutdown"
 path=/home/username/xmms2-tutorial/c/service_client/shutdown
 auto=no
 
 [Dummy service]
 description=This is testing service 1.
 major=1
 minor=0
 Dummy method=This is a dummy method.

You may have noticed that I do not have "argv" in the config file, because it is optional and I do not need to pass the executable file any argument.  For describing method, method name should show up as the keyword, and method description is on the right hand side of the equal sign.

= scm API =

There are two services provided by scm, se.xmms.scm.management and se.xmms.scm.query, which deals with service client management and querying service client information, respectively.

== Management ==
se.xmms.scm.management provides the following methods.

{| class="wikitable" style="margin: 1em auto 1em auto"
|+Management Methods
|-
! Method Name !! Description
|-
! launch
| Launch a service client
|-
! shutdown
| Shutdown a service client
|-
! change_argv
| Change the command-line argument to pass to a service client
|-
! toggle_autostart
| If a service client should be launched automatically
|-
|}

The following tables list argument and return types of each method described above.  Return types are separated by an empty line.

{| class="wikitable" style="margin: 1em auto 1em auto"
|+launch
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
| ||
|-
! ret
| string || return value
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+shutdown
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
| ||
|-
! ret
| string || return value
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+change_argv
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
! argv
| string || command-line arguments to pass to the service client
|-
| ||
|-
! ret
| string || return value
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+toggle_autostart
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
! auto
| uint32 || If the service client should be launched automatically
|-
| ||
|-
! ret
| string || return value
|-
|}

== Querying ==
se.xmms.scm.query provides the following methods.

{| class="wikitable" style="margin: 1em auto 1em auto"
|+Querying Methods
|-
! Method Name !! Description
|-
! sc_ids
| List the names of all installed service clients
|-
! sc
| List details of an installed service client
|-
! service_ids
| List the names of all services of a service client
|-
! service
| List details of a service
|-
! method_ids
| List the names of all methods of a service
|-
! method
| List details of a method
|-
! lookup_client
| Search for all service clients which provide the given service
|-
|}

The following tables list argument and return types of each method described above.  Return types are separated by an empty line.

{| class="wikitable" style="margin: 1em auto 1em auto"
|+sc_ids
|-
! Name !! Type !! Description
|-
| ||
|-
! ids
| string list || a list of all installed service clients' names
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+sc
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
| ||
|-
! argv
| string || command-line arguments to pass to the service client
|-
! auto
| uint32 || If the service client should be launched automatically
|-
! services
| uint32 || number of services the service client provides
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+service_ids
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
| ||
|-
! ids
| string list || a list of the names of all services the service client provides
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+service
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
! service_name
| string || service name
|-
| ||
|-
! desc
| string || service description
|-
! major
| uint32 || service major version
|-
! minor
| uint32 || service minor version
|-
! registered
| uint32 || if the service is registered on the server
|-
! methods
| uint32 || number of methods the service provides
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+method_ids
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
! service_name
| string || service name
|-
| ||
|-
! ids
| string list || a list of the names of all methods the service provides
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+method
|-
! Name !! Type !! Description
|-
! client_name
| string || client name
|-
! service_name
| string || service name
|-
! method_name
| string || method name
|-
| ||
|-
! desc
| string || method description
|-
! registered
| uint32 || if the method is registered on the server
|-
|}

{| class="wikitable" style="margin: 1em auto 1em auto"
|+lookup_client
|-
! Name !! Type !! Description
|-
! service_name
| string || service name
|-
| ||
|-
! ids
| string list || a list of the names of all service clients which provide the service
|-
|}

Go back to [[Summer of Code 2007/Service Clients|Service Client Summary]].