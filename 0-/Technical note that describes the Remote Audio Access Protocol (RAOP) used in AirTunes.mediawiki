= Overview =

This technical note describes the Remote Audio Access Protocol (RAOP) as used in Apple 
iTunes to stream music to the Airport Express (ApEx). Although RAOP is not documented, 
it is quite simple to analyze. RAOP is based on the Real Time Streaming Protocol (RTSP) 
but with an extra challenge-response based authentication step. The description of RAOP 
here is partly based on previous reverse-engineering efforts [1, 2, 3]. I also independently 
analyzed RAOP by analyzing the network packets exchanged observed between an iTunes client 
(v6.0.4) and ApEx (firmware v6.3). Please note that my understanding of the authentication 
step differs from [2] and is based on packet analysis and [3].

----
= ApEx Discovery =

ApEx and iTunes discover each other by using the Multicast DNS (MDNS)/Service Discovery protocol from the Bonjour protocol suite. This is a very simple exchange involving the respective MDNS TXT service records of ApEx and iTunes services.

----
= RAOP =

RAOP uses two channels for streaming music: a control channel which uses RTSP and a data 
channel for sending the raw data. Upon startup, iTunes initiates a RTSP connection to the 
Airport on port 5000. This exchange is shown below (Traffic from iTunes to ApEx is in Blue 
and the reverse direction is in Red):

== Traffic from iTunes to ApEx ==

OPTIONS * RTSP/1.0
CSeq: 1
User-Agent: iTunes/6.0.4 (Macintosh; N; PPC)
Client-Instance: 99BB1C4A4056F46D
DACP-ID: 99BB1C4A4056F46D
Active-Remote: 4294936225
Apple-Challenge: X/GmLMLuFvgWf8Y1bQuUug

== Traffic from iTunes to ApEx ==

RTSP/1.0 200 OK
CSeq: 1
Public: ANNOUNCE, SETUP, RECORD, PAUSE, FLUSH, TEARDOWN, OPTIONS, GET_PARAMETER, SET_PARAMETER
Apple-Response: fUG5XtwIbJDWcpYX7p81z7bYfWD7UKa9VkIQk40szRYT0kP8VJ+30l7YRdvwR2hMxUtjoDDIjqFdDi
Su50SfxfEtnquj7nFyR8gqJKnXNnpgegBaaFatoCLHTaH7Nc5H4yH/MQ2qrHtJ/5i+R7ElCd29xaC31r/wfDYgxMy2Ymoe
aRnvudSUOURHsOO8mEbJYfNp1rC2+W7EGwYyN/QQ98/kREUPO1et2qz7THEUs0n22ql/2VA88EgpyDsQMNIuUdOXdjrH1M
oqz+yG0KmKJyP8WoehJPhfW1da4YJSW2qAahQZRgJ7x7M3KUGEhzut8pf6CP/U1FRJqj7KFMTwTg
Audio-Jack-Status: connected; type=analog